<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gutta Quiz â€” Leaderboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Fraunces:wght@700;900&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
:root{
  --bg:#0a0c10;--surf:#12151d;--surf2:#1a1e2a;--surf3:#222736;
  --border:#2c3145;--accent:#4fffb0;--red:#ff5f6d;--yellow:#ffc947;
  --blue:#5eb8ff;--text:#e8eaf2;--muted:#5a6080;
  --font:'DM Sans',system-ui,sans-serif;
  --mono:'DM Mono',monospace;--display:'Fraunces',Georgia,serif;
  --gold:#ffd700;--silver:#c0c0c0;--bronze:#cd7f32;
}
html,body{height:100%;overflow:hidden;}
body{
  background:var(--bg);color:var(--text);font-family:var(--font);
  display:flex;flex-direction:column;align-items:center;justify-content:flex-start;
  padding:40px 60px 32px;
  background-image:
    radial-gradient(ellipse 70% 50% at 20% 10%,rgba(79,255,176,.07) 0%,transparent 60%),
    radial-gradient(ellipse 60% 60% at 80% 90%,rgba(94,184,255,.06) 0%,transparent 60%);
}

/* â”€â”€ HEADER â”€â”€ */
.header{width:100%;display:flex;align-items:center;justify-content:space-between;margin-bottom:40px;flex-shrink:0;}
.title-block{}
.title{font-family:var(--display);font-size:3.2rem;font-weight:900;letter-spacing:-2px;color:var(--accent);line-height:1;}
.title span{color:var(--text);}
.subtitle{color:var(--muted);font-size:1rem;margin-top:4px;}
.meta-block{text-align:right;}
.player-count{font-family:var(--mono);font-size:1rem;color:var(--muted);}
.player-count strong{color:var(--accent);font-size:1.3rem;}
.live-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(79,255,176,.1);border:1px solid rgba(79,255,176,.25);border-radius:99px;padding:5px 14px;font-size:.8rem;font-weight:700;color:var(--accent);letter-spacing:1px;text-transform:uppercase;margin-top:8px;}
.live-dot{width:8px;height:8px;border-radius:50%;background:var(--accent);animation:blink 1.4s ease-in-out infinite;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:.2;}}

/* â”€â”€ PODIUM â”€â”€ */
.podium-wrap{width:100%;display:flex;align-items:flex-end;justify-content:center;gap:20px;margin-bottom:36px;flex-shrink:0;}
.podium-item{display:flex;flex-direction:column;align-items:center;gap:10px;flex:1;max-width:240px;}
.podium-avatar{width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.8rem;border:3px solid;flex-shrink:0;}
.podium-name{font-family:var(--display);font-size:1.1rem;font-weight:700;text-align:center;max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.podium-score{font-family:var(--mono);font-size:1.3rem;font-weight:700;}
.podium-block{width:100%;border-radius:12px 12px 0 0;display:flex;align-items:center;justify-content:center;font-size:2.5rem;padding:20px 0;}
.podium-item.p1 .podium-avatar{border-color:var(--gold);background:rgba(255,215,0,.1);color:var(--gold);}
.podium-item.p1 .podium-name{color:var(--gold);}
.podium-item.p1 .podium-score{color:var(--gold);}
.podium-item.p1 .podium-block{background:rgba(255,215,0,.12);border:1px solid rgba(255,215,0,.3);height:140px;}
.podium-item.p2 .podium-avatar{border-color:var(--silver);background:rgba(192,192,192,.1);}
.podium-item.p2 .podium-name{color:var(--silver);}
.podium-item.p2 .podium-score{color:var(--silver);}
.podium-item.p2 .podium-block{background:rgba(192,192,192,.08);border:1px solid rgba(192,192,192,.2);height:100px;}
.podium-item.p3 .podium-avatar{border-color:var(--bronze);background:rgba(205,127,50,.1);}
.podium-item.p3 .podium-name{color:var(--bronze);}
.podium-item.p3 .podium-score{color:var(--bronze);}
.podium-item.p3 .podium-block{background:rgba(205,127,50,.08);border:1px solid rgba(205,127,50,.2);height:70px;}
.podium-empty .podium-avatar{border-color:var(--border);background:var(--surf2);color:var(--muted);font-size:1.2rem;}
.podium-empty .podium-name{color:var(--muted);}
.podium-empty .podium-score{color:var(--muted);}

/* â”€â”€ REST OF TABLE â”€â”€ */
.rest-table{width:100%;flex:1;overflow:hidden;}
.rest-row{display:grid;grid-template-columns:52px 1fr auto auto;align-items:center;gap:16px;padding:12px 20px;border-radius:12px;background:var(--surf);border:1px solid var(--border);margin-bottom:8px;animation:slideIn .4s cubic-bezier(.22,1,.36,1);}
@keyframes slideIn{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}
.rr-rank{font-family:var(--mono);font-size:.95rem;font-weight:700;color:var(--muted);text-align:center;}
.rr-name{font-size:1rem;font-weight:600;color:var(--text);}
.rr-bar-wrap{width:160px;height:8px;background:var(--surf2);border-radius:99px;overflow:hidden;}
.rr-bar{height:100%;background:linear-gradient(90deg,var(--blue),var(--accent));border-radius:99px;transition:width .8s cubic-bezier(.22,1,.36,1);}
.rr-pts{font-family:var(--mono);font-size:1rem;font-weight:700;color:var(--accent);white-space:nowrap;min-width:80px;text-align:right;}

/* â”€â”€ EMPTY STATE â”€â”€ */
.empty{text-align:center;padding:60px 0;color:var(--muted);}
.empty-emoji{font-size:3rem;margin-bottom:12px;}
.empty-text{font-size:1.1rem;}

/* â”€â”€ MAX SCORE DISPLAY â”€â”€ */
.max-score-line{font-size:.8rem;color:var(--muted);text-align:center;margin-top:16px;flex-shrink:0;}
.max-score-line strong{color:var(--text);}

/* â”€â”€ CONNECTING â”€â”€ */
.connecting{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;z-index:100;}
.connecting.hidden{display:none;}
.connecting-spinner{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}
.connecting-text{color:var(--muted);font-size:1rem;}
</style>
</head>
<body>

<!-- Connecting overlay -->
<div class="connecting" id="connecting">
  <div class="connecting-spinner"></div>
  <div class="connecting-text">Kobler til leaderboardâ€¦</div>
</div>

<!-- Header -->
<div class="header">
  <div class="title-block">
    <div class="title">Gutta<span> Quiz</span></div>
    <div class="subtitle">laget av Mathias</div>
  </div>
  <div class="meta-block">
    <div class="player-count"><strong id="playerCount">0</strong> spillere ferdig</div>
    <div class="live-badge"><span class="live-dot"></span>LIVE</div>
  </div>
</div>

<!-- Podium (top 3) -->
<div class="podium-wrap" id="podium"></div>

<!-- Rest (4th and below) -->
<div class="rest-table" id="restTable"></div>

<!-- Max score -->
<div class="max-score-line" id="maxScoreLine"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyALjLzP2eMSOcoop3KNRtEDFc13J57AZ_g",
  authDomain: "quiz-de49c.firebaseapp.com",
  databaseURL: "https://quiz-de49c-default-rtdb.firebaseio.com",
  projectId: "quiz-de49c",
  storageBucket: "quiz-de49c.firebasestorage.app",
  messagingSenderId: "303601116783",
  appId: "1:303601116783:web:3d57bcbfa347af9c578f9a"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

function esc(str){ return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

function getInitials(name){
  const parts = name.trim().split(/\s+/);
  if(parts.length >= 2) return (parts[0][0] + parts[1][0]).toUpperCase();
  return name.slice(0,2).toUpperCase();
}

const MEDALS = ['ðŸ¥‡','ðŸ¥ˆ','ðŸ¥‰'];
const PODIUM_ORDER = [1,0,2]; // render 2nd, 1st, 3rd for podium shape

function render(players){
  document.getElementById('connecting').classList.add('hidden');
  document.getElementById('playerCount').textContent = players.length;

  const maxScore = players[0]?.maxScore || 131;
  document.getElementById('maxScoreLine').innerHTML = `Maks poeng i quizen: <strong>${maxScore} poeng</strong>`;

  const podiumEl = document.getElementById('podium');
  const restEl = document.getElementById('restTable');

  // â”€â”€ PODIUM â”€â”€
  const top3 = [players[0], players[1], players[2]];
  const podiumClasses = ['p2','p1','p3'];
  const podiumHeights = [100, 140, 70];

  podiumEl.innerHTML = PODIUM_ORDER.map(idx => {
    const p = top3[idx];
    const cls = podiumClasses[idx];
    if(!p) return `<div class="podium-item ${cls} podium-empty">
      <div class="podium-avatar">?</div>
      <div class="podium-name">â€”</div>
      <div class="podium-score">â€”</div>
      <div class="podium-block" style="height:${podiumHeights[idx]}px">${MEDALS[idx]}</div>
    </div>`;
    const pct = Math.round(p.score / maxScore * 100);
    return `<div class="podium-item ${cls}">
      <div class="podium-avatar">${esc(getInitials(p.name))}</div>
      <div class="podium-name">${esc(p.name)}</div>
      <div class="podium-score">${p.score} pts</div>
      <div class="podium-block" style="height:${podiumHeights[idx]}px">${MEDALS[idx]}</div>
    </div>`;
  }).join('');

  // â”€â”€ REST (4th+) â”€â”€
  const rest = players.slice(3);
  if(!rest.length){ restEl.innerHTML = ''; return; }
  restEl.innerHTML = rest.map((p, i) => {
    const rank = i + 4;
    const pct = Math.round(p.score / maxScore * 100);
    return `<div class="rest-row">
      <div class="rr-rank">${rank}</div>
      <div class="rr-name">${esc(p.name)}</div>
      <div class="rr-bar-wrap"><div class="rr-bar" style="width:${pct}%"></div></div>
      <div class="rr-pts">${p.score} / ${maxScore}</div>
    </div>`;
  }).join('');
}

// Listen for real-time updates
const scoresRef = ref(db, 'scores');
onValue(scoresRef, (snapshot) => {
  const data = snapshot.val();
  if(!data){
    document.getElementById('connecting').classList.add('hidden');
    document.getElementById('podium').innerHTML = `<div class="empty"><div class="empty-emoji">ðŸŽ®</div><div class="empty-text">Venter pÃ¥ spillereâ€¦</div></div>`;
    document.getElementById('playerCount').textContent = '0';
    return;
  }

  // Deduplicate: keep highest score per player name
  const byName = {};
  Object.values(data).forEach(entry => {
    const key = entry.name?.toLowerCase().trim();
    if(!key) return;
    if(!byName[key] || entry.score > byName[key].score){
      byName[key] = entry;
    }
  });

  const players = Object.values(byName).sort((a,b) => b.score - a.score);
  render(players);
});
</script>
</body>
</html>
